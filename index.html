<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="images/icon-512.png">
    <title>PWA Sample</title>
    <script src="app.js"></script>
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <script>
      window.OneSignalDeferred = window.OneSignalDeferred || [];
      OneSignalDeferred.push(async function(OneSignal) {
        OneSignal.init({
          appId: "bb2950f4-045a-443e-aede-0cdecd0ec239",
          safari_web_id: "web.onesignal.auto.4dbe0dd2-36c1-4474-980b-740086f7dd0e",
          notifyButton: {
            enable: true,
          },
        });

        // ユーザーを作成し、External User IDを設定する関数
        async function createUserAndSetExternalId(userId) {
          try {
            const user = await OneSignal.createUserAsync('bb2950f4-045a-443e-aede-0cdecd0ec239', {
              id: userId, // ユーザーIDを設定
              properties: {
                tags: {
                  additionalProp1: {},
                },
                language: 'en',
                timezone_id: 'UTC',
                lat: 0,
                long: 0,
                country: 'US',
                first_active: 0,
                last_active: 0,
                amount_spent: 0,
                purchases: [],
                ip: '127.0.0.1',
              },
              identity: {
                additionalProp1: {},
              },
              subscriptions: [],
              subscription_options: {
                retain_previous_owner: true,
              }
            });
            console.log('User created:', user);
          } catch (err) {
            console.error('Error creating user:', err);
          }
        }

        // フォーム送信時にユーザーを作成しExternal IDを設定
        document.getElementById('userIdForm').addEventListener('submit', function(event) {
          event.preventDefault();
          var userId = document.getElementById('userIdInput').value;
          createUserAndSetExternalId(userId);
        });
      });
    </script>
</head>
<body>
    <div>
        <form id="userIdForm">
            <label for="userIdInput">ユーザーIDを入力してくださいい:</label>
            <input type="text" id="userIdInput" name="userIdInput" required>
            <button type="submit">送信</button>
        </form>
    </div>
    <input type="button" value="バッジリセット！" onclick="reset();" id="resetBtn" style="font-size: 20px; padding: 15px 30px; margin: 10px; background-color: #4CAF50; color: white; border-radius: 10px;">
    
    <script>
        navigator.serviceWorker.register('sw.js');
    </script>    
</body>
</html>
